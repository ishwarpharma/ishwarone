<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ishwar Pharma Order Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f2f7ff;
    }
    header {
      background-color: #007bff;
      color: white;
      padding: 10px;
      text-align: center;
      font-size: 24px;
    }
    .screen {
      display: none;
      padding: 20px;
    }
    .screen.active {
      display: block;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      margin-bottom: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    .cart-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    .cart-table th, .cart-table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    .cart-table th {
      background-color: #007bff;
      color: white;
    }
    .action-buttons button {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 10px;
      margin-top: 20px;
      cursor: pointer;
    }
    .action-buttons button:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>
  <header>üìù Ishwar Pharma Order Form</header>
  <main>
    <div class="screen active" id="screen1">
      <label>Date:</label>
      <input type="text" id="date" readonly />
      <label>Salesman Name:</label>
      <input type="text" id="salesman" />
      <label>Party Name:</label>
      <input type="text" id="party" />
      <label>Place/District:</label>
      <input type="text" id="place" />
      <button onclick="nextScreen()">üöÄ Start Ordering</button>
    </div>

    <div class="screen" id="screen2">
      <label>Search Product (Item or Company):</label>
      <input type="text" id="productSearch" placeholder="Enter item or company..." oninput="searchProduct()" />
      <div id="searchResults"></div>

      <div id="productForm" style="display: none;">
        <label>Quantity:</label>
        <input type="number" id="quantity" />
        <label>Discount %:</label>
        <input type="number" id="discount" />
        <label>Special Rate:</label>
        <input type="number" id="specialRate" />
        <p id="priceInfo"></p>
        <button onclick="addToCart()">‚ûï Add to Cart</button>
      </div>

      <table class="cart-table" id="cartTable">
        <thead>
          <tr>
            <th>S.No.</th>
            <th>Product</th>
            <th>Qty</th>
            <th>Rate</th>
            <th>Spl Rate</th>
            <th>Disc%</th>
            <th>Amount</th>
            <th>‚ùå</th>
          </tr>
        </thead>
        <tbody id="cartBody"></tbody>
      </table>

      <div class="action-buttons">
        <button onclick="finalizeOrder()">‚úÖ Finalize & Download PDF</button>
        <button onclick="resetOrder()">üîÑ Reset</button>
      </div>
    </div>
  </main>

  <script>
    let products = [
      { name: "URODIV", company: "Ishwar", rate: 52, mrp: 98 },
      { name: "ZERODER SP", company: "Ishwar", rate: 18, mrp: 35 },
      { name: "ZERODER MR", company: "Ishwar", rate: 14, mrp: 27 },
      { name: "VITAMIN C", company: "ABC", rate: 10, mrp: 20 },
      { name: "PARACETAMOL", company: "XYZ", rate: 8, mrp: 15 }
    ];

    let cart = [];
    let selectedProduct = null;

    window.onload = function () {
      const dateField = document.getElementById("date");
      const today = new Date().toISOString().slice(0, 10);
      dateField.value = today;
    };

    function nextScreen() {
      document.getElementById("screen1").classList.remove("active");
      document.getElementById("screen2").classList.add("active");
    }

    function searchProduct() {
      const searchInput = document.getElementById("productSearch").value.toLowerCase();
      const resultsDiv = document.getElementById("searchResults");
      resultsDiv.innerHTML = "";
      selectedProduct = null;

      if (searchInput.length < 3) return;

      const terms = searchInput.split(" ");
      const brandTerm = terms[0];
      const companyTerm = terms[1] || "";

      const matches = products.filter(p =>
        p.name.toLowerCase().includes(brandTerm) &&
        p.company.toLowerCase().includes(companyTerm)
      );

      matches.forEach((product, index) => {
        const div = document.createElement("div");
        div.textContent = `${product.name} (${product.company})`;
        div.onclick = () => selectProduct(product);
        resultsDiv.appendChild(div);
      });
    }

    function selectProduct(product) {
      selectedProduct = product;
      document.getElementById("productForm").style.display = "block";
      document.getElementById("priceInfo").textContent = `Normal Rate: ‚Çπ${product.rate}, MRP: ‚Çπ${product.mrp}`;
    }

    function addToCart() {
      const qty = parseFloat(document.getElementById("quantity").value);
      const disc = parseFloat(document.getElementById("discount").value);
      const splRate = parseFloat(document.getElementById("specialRate").value);

      const rate = selectedProduct.rate;
      const finalRate = splRate > 0 ? splRate : rate - (rate * (disc || 0)) / 100;
      const amount = qty * finalRate;

      cart.push({
        ...selectedProduct,
        qty,
        rate,
        splRate,
        disc,
        amount
      });

      document.getElementById("productForm").style.display = "none";
      document.getElementById("productSearch").value = "";
      document.getElementById("searchResults").innerHTML = "";
      updateCart();
    }

    function updateCart() {
      const tbody = document.getElementById("cartBody");
      tbody.innerHTML = "";

      cart.forEach((item, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${index + 1}</td>
          <td>${item.name}</td>
          <td>${item.qty}</td>
          <td>${item.rate}</td>
          <td>${item.splRate}</td>
          <td>${item.disc}</td>
          <td>${item.amount.toFixed(2)}</td>
          <td><button onclick="removeItem(${index})">‚ùå</button></td>
        `;
        tbody.appendChild(row);
      });
    }

    function removeItem(index) {
      cart.splice(index, 1);
      updateCart();
    }

    function resetOrder() {
      cart = [];
      updateCart();
      document.getElementById("productForm").style.display = "none";
      document.getElementById("productSearch").value = "";
      document.getElementById("searchResults").innerHTML = "";
    }

    function finalizeOrder() {
      let content = `Date: ${document.getElementById("date").value}\nSalesman: ${document.getElementById("salesman").value}\nParty: ${document.getElementById("party").value}\nPlace: ${document.getElementById("place").value}\n\n`;
      content += "S.No\tProduct\tQty\tRate\tSpl Rate\tDisc%\tAmount\n";

      cart.forEach((item, index) => {
        content += `${index + 1}\t${item.name}\t${item.qty}\t${item.rate}\t${item.splRate}\t${item.disc}\t${item.amount.toFixed(2)}\n`;
      });

      const total = cart.reduce((sum, item) => sum + item.amount, 0);
      content += `\nGrand Total: ‚Çπ${total.toFixed(2)}`;

      const blob = new Blob([content], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "Ishwar_Order.txt";
      link.click();
    }
  </script>
</body>
</html>
